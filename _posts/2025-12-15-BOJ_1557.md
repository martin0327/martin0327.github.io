---
layout: default
title: "Square-Free Integers, Möbius Function, and BOJ 1557"
---

# Square-Free Integers, Möbius Function, and BOJ 1557

https://www.acmicpc.net/problem/1557

## 0. Definition of the Möbius Function

For $n \ge 1$:

$$
\mu(n) =
\begin{cases}
1 & n = 1 \\
0 & \text{if } p^2 \mid n \text{ for some prime } p \\
(-1)^k & n = p_1 p_2 \cdots p_k \text{ with distinct primes}
\end{cases}
$$

------------------------------------------------------------------------

## Lemma A. Sums Over Divisors Preserve Multiplicativity

If $f(n)$ is multiplicative, then:

$$
F(n) = \sum_{d \mid n} f(d)
$$

is also multiplicative.

### Proof

We must show that if $\gcd(m,n)=1$, then:

$$
F(mn) = F(m)F(n).
$$

Start from the right-hand side:

$$
F(m)F(n)
= \left(\sum_{d_1 \mid m} f(d_1)\right)
  \left(\sum_{d_2 \mid n} f(d_2)\right)
= \sum_{d_1 \mid m} \sum_{d_2 \mid n} f(d_1)f(d_2).
$$

Since $\gcd(m,n)=1$, every divisor $d_1 \mid m$ and $d_2 \mid n$
satisfies:

$$
\gcd(d_1,d_2)=1.
$$

Because $f$ is multiplicative:

$$
f(d_1)f(d_2) = f(d_1 d_2).
$$

Thus:

$$
F(m)F(n)
= \sum_{d_1 \mid m} \sum_{d_2 \mid n} f(d_1 d_2).
$$

Now we use the following elementary number-theoretic fact:

If $\gcd(m,n)=1$, then every divisor $d$ of $mn$ can be written uniquely
as:

$$
d = d_1 d_2
$$

with:

$$
d_1 \mid m, \quad d_2 \mid n.
$$

Therefore, the double sum becomes a single sum:

$$
F(m)F(n)
= \sum_{d \mid mn} f(d)
= F(mn).
$$

This proves the lemma.

------------------------------------------------------------------------

## Property 1. The Möbius Function is Multiplicative

If $\gcd(m,n)=1$, then:

$$
\mu(mn) = \mu(m)\mu(n).
$$

### Proof

Write:

$$
m = \prod p_i^{a_i}, \qquad n = \prod q_j^{b_j}.
$$

Since $\gcd(m,n)=1$, the prime sets $\{p_i\}$ and $\{q_j\}$ are
disjoint.

If $m$ or $n$ contains a squared prime factor, then $mn$ also does, so
both sides vanish.

Otherwise both $m$ and $n$ are square-free:

$$
\mu(m) = (-1)^{\omega(m)}, \quad \mu(n) = (-1)^{\omega(n)}.
$$

Since the prime sets are disjoint:

$$
\omega(mn)=\omega(m)+\omega(n).
$$

Hence:

$$
\mu(mn) = (-1)^{\omega(mn)} = (-1)^{\omega(m)+\omega(n)} = \mu(m)\mu(n).
$$

------------------------------------------------------------------------

## Property 2. Divisor Sum of the Möbius Function

For all $n \ge 1$:

$$
\sum_{d \mid n} \mu(d)
=
\begin{cases}
1 & n = 1 \\
0 & n > 1
\end{cases}
$$

### Proof

Define:

$$
G(n) = \sum_{d \mid n} \mu(d).
$$

Since $\mu$ is multiplicative and sums over divisors preserve
multiplicativity (Lemma A), $G(n)$ is multiplicative.

It is therefore enough to check prime powers:

$$
n = p^k.
$$

The divisors of $p^k$ are:

$$
1, p, p^2, \dots, p^k.
$$

Using the definition of $\mu$:

$$
\mu(1)=1, \quad \mu(p)=-1, \quad \mu(p^2)=\mu(p^3)=\cdots=0.
$$

Therefore:

$$
G(p^k) = \mu(1)+\mu(p) = 1 + (-1) = 0 \quad (k \ge 1),
$$

and clearly $G(1)=1$.

This proves Property 2.

------------------------------------------------------------------------

## Property 3. Square-Free Detection Identity

For all $n \ge 1$:

$$
\mu(n)^2 = \sum_{d^2 \mid n} \mu(d).
$$

------------------------------------------------------------------------

### Proof of Property 3

Define:

$$
f(n) = \sum_{d^2 \mid n} \mu(d).
$$

#### Step 1. $f(n)$ is multiplicative

Let $\gcd(m,n)=1$. Then:

$$
f(m)f(n)
= \left(\sum_{r^2 \mid m} \mu(r)\right)
  \left(\sum_{s^2 \mid n} \mu(s)\right)
= \sum_{r^2 \mid m,\, s^2 \mid n} \mu(r)\mu(s).
$$

Since $\gcd(r,s)=1$:

$$
\mu(r)\mu(s) = \mu(rs).
$$

Also:

$$
r^2 \mid m, \quad s^2 \mid n
\iff (rs)^2 \mid mn.
$$

Thus:

$$
f(m)f(n) = \sum_{d^2 \mid mn} \mu(d) = f(mn).
$$

So $f(n)$ is multiplicative.

------------------------------------------------------------------------

#### Step 2. Evaluate $f(n)$ on prime powers

Let:

$$
n = p^k.
$$

The integers $d$ such that $d^2 \mid p^k$ are:

$$
d = 1, p, p^2, \dots, p^{\lfloor k/2 \rfloor}.
$$

But:

$$
\mu(1)=1, \quad \mu(p)=-1, \quad \mu(p^2)=\mu(p^3)=\cdots=0.
$$

So:

-   If $k=0$: $f(1)=1$
-   If $k=1$: $f(p)=1$
-   If $k \ge 2$:

$$
f(p^k) = \mu(1)+\mu(p) = 1-1=0.
$$

These values equal $\mu(n)^2$ in all cases. Hence:

$$
f(n)=\mu(n)^2.
$$

------------------------------------------------------------------------

## Square-Free Counting Function

Define:

$$
F(x) = \#\{n \le x : n \text{ square-free} \}.
$$

Then:

$$
F(x) = \sum_{n \le x} \mu(n)^2.
$$

Using Property 3:

$$
F(x)
= \sum_{n \le x} \sum_{d^2 \mid n} \mu(d).
$$

We now re-index the same valid pairs $(n,d)$:

$$
F(x)
= \sum_{d \ge 1} \mu(d)
\sum_{\substack{n \le x \\ d^2 \mid n}} 1.
$$

The inner sum counts multiples of $d^2$:

$$
\sum_{\substack{n \le x \\ d^2 \mid n}} 1
= \left\lfloor \frac{x}{d^2} \right\rfloor.
$$

So:

$$
F(x)
= \sum_{d=1}^{\lfloor \sqrt{x} \rfloor}
\mu(d) \left\lfloor \frac{x}{d^2} \right\rfloor.
$$

------------------------------------------------------------------------

## BOJ 1557 -- K-th Square-Free Number

We are given $K$ and must find the smallest $x$ such that:

$$
F(x) \ge K.
$$

------------------------------------------------------------------------

## Algorithm

### Step 1. Precompute $\mu(d)$

Compute the Möbius function using a sieve up to:

$$
d \le \sqrt{2 \times 10^9} \approx 45000.
$$

### Step 2. Implement the counting function

``` cpp
long long square_free_count(long long x) {
    long long ret = 0;
    for (int d = 1; 1LL * d * d <= x; d++) {
        ret += mu[d] * (x / (1LL * d * d));
    }
    return ret;
}
```

### Step 3. Binary Search

Binary search for the smallest $x$ such that:

``` cpp
square_free_count(x) >= K
```

------------------------------------------------------------------------

## Complexity Analysis

-   Möbius sieve: $O(N)$ for $N \approx 45000$
-   One count: $O(\sqrt{x})$
-   Binary search iterations: about $31$
-   Total operations: about $1.5$ million

------------------------------------------------------------------------

## Final Conceptual Summary

-   Property 1 controls multiplicativity of $\mu$.
-   Property 2 makes $\mu$ the inverse of the constant $1$ under
    convolution.
-   Property 3 converts square-freeness into a divisor sum.
-   Re-indexing converts it into a computable counting formula.
-   Binary search finds the $K$-th square-free number.

------------------------------------------------------------------------

This completes the full rigorous proof and solution for BOJ 1557.

Reference : https://dgrozev.wordpress.com/2022/05/07/square-free-integers-mobius-function-dirichlets-convolution/
